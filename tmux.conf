# ──────────────────────────────────────────────
# TMUX CONFIG - Enhanced Version
# ──────────────────────────────────────────────

# ══════════════════════════════════════════════
# TERMINAL SETTINGS
# ══════════════════════════════════════════════
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# ══════════════════════════════════════════════
# PREFIX KEY
# ══════════════════════════════════════════════
unbind C-b                 # Remove default prefix
set -g prefix C-a          # Set Ctrl+a as prefix
bind-key C-a send-prefix   # Send Ctrl+a to application

# ══════════════════════════════════════════════
# WINDOW & PANE SETTINGS
# ══════════════════════════════════════════════
# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# ══════════════════════════════════════════════
# WINDOW SPLITTING (open in current directory)
# ══════════════════════════════════════════════
unbind %
bind | split-window -h -c "#{pane_current_path}"  # Vertical split (Ctrl+a |)
unbind '"'
bind - split-window -v -c "#{pane_current_path}"  # Horizontal split (Ctrl+a -)

# New window in current path
bind c new-window -c "#{pane_current_path}"

# ══════════════════════════════════════════════
# RELOAD CONFIG
# ══════════════════════════════════════════════
unbind r
bind r source-file ~/.tmux.conf \; display "Config Reloaded!"

# ══════════════════════════════════════════════
# PANE RESIZING
# ══════════════════════════════════════════════
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5
bind -r m resize-pane -Z       # Toggle zoom for current pane

# ══════════════════════════════════════════════
# MOUSE SUPPORT
# ══════════════════════════════════════════════
set -g mouse on

# ══════════════════════════════════════════════
# VI-STYLE COPY MODE
# ══════════════════════════════════════════════
set-window-option -g mode-keys vi

# Vi-style selection and copy
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-pipe-and-cancel 'xclip -in -selection clipboard'

# For macOS, use pbcopy instead:
# bind-key -T copy-mode-vi 'y' send -X copy-pipe-and-cancel 'pbcopy'

# Keep copy mode while dragging with mouse
unbind -T copy-mode-vi MouseDragEnd1Pane

# ══════════════════════════════════════════════
# PERFORMANCE & TIMING
# ══════════════════════════════════════════════
set -sg escape-time 10              # Faster command sequences (important for Neovim)
set -g history-limit 50000          # Increase scrollback buffer
set -g display-time 4000            # Display messages for 4 seconds
set -g status-interval 5            # Refresh status bar every 5 seconds
setw -g aggressive-resize on        # Better multi-monitor support

# ══════════════════════════════════════════════
# USEFUL KEYBINDINGS
# ══════════════════════════════════════════════
# Toggle synchronized panes (send commands to all panes)
bind -n C-x setw synchronize-panes

# Attach session in current path
bind M-c attach-session -c "#{pane_current_path}"

# Quick pane switching (Alt+arrow keys, no prefix needed)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# ══════════════════════════════════════════════
# TMUX PLUGIN MANAGER (TPM)
# ══════════════════════════════════════════════
set -g @plugin 'tmux-plugins/tpm'

# ──────────────────────────────────────────────
# PLUGINS
# ──────────────────────────────────────────────
# Seamless navigation between Vim and Tmux (Ctrl+h/j/k/l)
set -g @plugin 'christoomey/vim-tmux-navigator'

# Color theme
set -g @plugin 'fabioluciano/tmux-tokyo-night'

# Persist sessions across reboots
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Yank to system clipboard
set -g @plugin 'tmux-plugins/tmux-yank'

# ──────────────────────────────────────────────
# PLUGIN OPTIONS
# ──────────────────────────────────────────────
# Resurrect options
set -g @resurrect-capture-pane-contents 'on'    # Save pane contents
set -g @resurrect-strategy-nvim 'session'       # Restore Neovim sessions

# Continuum options
set -g @continuum-restore 'on'                  # Auto-restore on tmux start
set -g @continuum-save-interval '15'            # Save every 15 minutes

# Yank options
set -g @yank_selection 'clipboard'              # Copy to system clipboard
set -g @yank_selection_mouse 'clipboard'        # Mouse selection to clipboard

# ══════════════════════════════════════════════
# INITIALIZE TPM (must be last line)
# ══════════════════════════════════════════════
run '~/.tmux/plugins/tpm/tpm'

